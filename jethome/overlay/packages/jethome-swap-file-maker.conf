#!/bin/bash
set -e # exit on failure

PROJECT_ARCH=all
PROJECT_VERSION=1.0.0
PROJECT_NAME=jethome-swap-file-maker
source /tmp/overlay/packages/common_package_mkdir

mkdir --mode=0755 -p -v $PACKAGE_NAME/usr
mkdir --mode=0755 -p -v $PACKAGE_NAME/usr/lib
mkdir --mode=0755 -p -v $PACKAGE_NAME/usr/lib/jethome
cp -fv /tmp/overlay/packages/$PROJECT_NAME/swap_file_maker $PACKAGE_NAME/usr/lib/jethome/
chmod +x $PACKAGE_NAME/usr/lib/jethome/swap_file_maker

mkdir --mode=0755 -p -v $PACKAGE_NAME/lib
mkdir --mode=0755 -p -v $PACKAGE_NAME/lib/systemd
mkdir --mode=0755 -p -v $PACKAGE_NAME/lib/systemd/system
cp -fv /tmp/overlay/packages/$PROJECT_NAME/jethome-swap-file-maker.service $PACKAGE_NAME/lib/systemd/system/

mkdir -p -v $PACKAGE_NAME/DEBIAN

cat <<-EOF > $PACKAGE_NAME/DEBIAN/control
Package: $PROJECT_NAME
Version: $PROJECT_VERSION
Section: utils
Priority: optional
Architecture: $PROJECT_ARCH
Depends: bash (>= 4.4)
Maintainer: Example Examplov <example@example.com>
Description: JetHome /swapfile maker
 systemd service which starts on first boot after rootfs parition is expanded,
 creates and enables swap. The service then disables itself.
EOF

cat <<-'EOF' > "$PACKAGE_NAME/DEBIAN/postinst"
#!/bin/bash
set -e

systemctl enable jethome-swap-file-maker.service

exit 0
EOF
chmod -v +x "$PACKAGE_NAME/DEBIAN/postinst"


source /tmp/overlay/packages/common_package_create_install_cleanup
